!function(e){var f=function(e){var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return f[e]}))},a=function(e){var f=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,(function(e,a){return void 0!==f[a]?f[a]:e}))},i=function(e,f,a){if(0==e)return"0 Bytes";if(1==e)return"1 Byte";var i,o;e=Math.abs(e),a&&"iec_formal"===a.toLowerCase()?(i=Math.pow(2,10),o=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]):a&&"si"===a.toLowerCase()?(i=Math.pow(10,3),o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]):(i=Math.pow(2,10),o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"]);var l=Math.floor(Math.log(e)/Math.log(i)),t=e/Math.pow(i,l);return(0==l||f&&t>=99.995?t.toFixed(0):t.toFixed(2))+" "+o[l]};e.fn.FancyFileUpload=function(o){if(this.each((function(){var f=e(this);if(f.data("fancy-fileupload")&&"object"==typeof f.data("fancy-fileupload")){f.removeClass("ff_fileupload_hidden");var a=f.data("fancy-fileupload");a.form.find("input[type=file]").fileupload("destroy"),a.form.remove(),a.fileuploadwrap.remove(),f.removeData("fancy-fileupload")}})),e(".ff_fileupload_hidden").length||(e(document).off("drop.fancy_fileupload dragover.fancy_fileupload"),e(window).off("beforeunload.fancy_fileupload")),"string"==typeof o&&"destroy"===o)return this;var l=e.extend({},e.fn.FancyFileUpload.defaults,o);l.preinit&&l.preinit(l),e(document).off("drop.fancy_fileupload dragover.fancy_fileupload"),e(document).on("drop.fancy_fileupload dragover.fancy_fileupload",(function(e){e.preventDefault()}));var t=function(e){return l.langmap[e]?l.langmap[e]:e};e(window).on("beforeunload.fancy_fileupload",(function(f){var a=e(".ff_fileupload_uploading, .ff_fileupload_starting"),i=e(".ff_fileupload_queued");if(a.length||i.length){if(a.removeClass("ff_fileupload_bounce"),setTimeout((function(){a.addClass("ff_fileupload_bounce")}),250),i.removeClass("ff_fileupload_bounce"),setTimeout((function(){i.addClass("ff_fileupload_bounce")}),250),a.length)return t("There is a file upload still in progress.  Leaving the page will cancel the upload.\n\nAre you sure you want to leave this page?");if(i.length)return t("There is a file that was added to the queue but the upload has not been started.  Leaving the page will clear the queue and not upload the file.\n\nAre you sure you want to leave this page?")}}));var d=document.createElement("audio"),n=document.createElement("video"),r=function(f,o,r){var s=e('<tr><td class="ff_fileupload_preview"><button class="ff_fileupload_preview_image" type="button"><span class="ff_fileupload_preview_text"></span></button><div class="ff_fileupload_actions_mobile"></div></td><td class="ff_fileupload_summary"><div class="ff_fileupload_filename"></div><div class="ff_fileupload_fileinfo"></div><div class="ff_fileupload_buttoninfo ff_fileupload_hidden"></div><div class="ff_fileupload_errors ff_fileupload_hidden"></div><div class="ff_fileupload_progress_background ff_fileupload_hidden"><div class="ff_fileupload_progress_bar"></div></div></td><td class="ff_fileupload_actions"></td></tr>'),u=r.files[0].name.lastIndexOf("."),p=u>-1?r.files[0].name.substring(0,u):r.files[0].name,_=u>-1?r.files[0].name.substring(u+1).toLowerCase():"",c="abcdefghijklmnopqrstuvwxyz0123456789";u=""==_?-1:c.indexOf(_.charAt(0));var v=c.charAt(u>-1?u:Math.floor(36*Math.random()));r.ff_info={},r.ff_info.errors=[],r.ff_info.retries=0,r.ff_info.retrydelay=l.retrydelay,r.ff_info.removewidget=!1,r.ff_info.inforow=s,r.ff_info.displayfilesize=i(r.files[0].size,l.adjustprecision,l.displayunits),r.context=s;var m=function(e){if(e.preventDefault(),l.edit&&!r.ff_info.errors.length){var f=s.find(".ff_fileupload_filename input");if(f.length){var a=f.val();""!=_&&(a+="."+_),s.find(".ff_fileupload_filename").text(a),r.files[0].uploadName=a}}s.find("button.ff_fileupload_start_upload").remove(),s.find(".ff_fileupload_fileinfo").removeClass("ff_fileupload_hidden"),s.find(".ff_fileupload_buttoninfo").addClass("ff_fileupload_hidden"),s.find(".ff_fileupload_fileinfo").text(r.ff_info.displayfilesize+" | "+t("Starting upload...")),s.find(".ff_fileupload_progress_background").removeClass("ff_fileupload_hidden"),s.find("button.ff_fileupload_remove_file").attr("aria-label",t("Cancel upload and remove from list")),s.removeClass("ff_fileupload_queued"),s.addClass("ff_fileupload_starting");var i=function(){s.removeClass("ff_fileupload_starting"),s.addClass("ff_fileupload_uploading"),r.submit()};l.startupload?l.startupload.call(s,i,e,r):i()},h=function(e){if(e.preventDefault(),s.hasClass("ff_fileupload_uploading")){if(!confirm(t("This file is currently being uploaded.\n\nStop the upload and remove the file from the list?")))return;r.ff_info.removewidget=!0,r.abort()}else{if(s.hasClass("ff_fileupload_starting")){if(!confirm(t("This file is waiting to start.\n\nCancel the operation and remove the file from the list?")))return;l.uploadcancelled&&l.uploadcancelled.call(r.ff_info.inforow,e,r)}s.remove(),delete r.ff_info}};r.ff_info.RemoveFile=function(){s.hasClass("ff_fileupload_uploading")?(r.ff_info.removewidget=!0,r.abort()):(s.hasClass("ff_fileupload_starting")&&l.uploadcancelled&&l.uploadcancelled.call(r.ff_info.inforow,o,r),s.remove(),delete r.ff_info)};var g,y=!1,w=!1;if(URL&&URL.createObjectURL){var b=URL.createObjectURL(r.files[0]);b&&("image/gif"===r.files[0].type||"image/jpeg"===r.files[0].type||"image/png"===r.files[0].type?(s.find(".ff_fileupload_preview_image").css("background-image",'url("'+b+'")'),y=!0,g=e("<img>").attr("src",b),w=!0):r.files[0].type.lastIndexOf("audio/",0)>-1&&d.canPlayType&&d.canPlayType(r.files[0].type)?(y=!0,g=e("<audio>").attr("src",b).prop("controls",!0)):r.files[0].type.lastIndexOf("video/",0)>-1&&n.canPlayType&&n.canPlayType(r.files[0].type)&&(y=!0,g=e("<video>").attr("src",b).prop("controls",!0)))}if(y?s.find(".ff_fileupload_preview_image").addClass("ff_fileupload_preview_image_has_preview").attr("aria-label",t("Preview")).click((function(f){f.preventDefault(),this.blur(),function(f,a,i,o,l){var t=e("<div>").addClass("ff_fileupload_dialog_background"),d=f.clone(!0,!0).click((function(e){e.stopPropagation()})),n=e("<div>").addClass("ff_fileupload_dialog_main").append(d),r=function(){e(document).off("keyup.fancy_fileupload"),t.remove(),a.focus(),l.hidepreview&&l.hidepreview.call(i,o,f,d)};e(document).on("keyup.fancy_fileupload",(function(e){27==e.keyCode&&r()})),t.append(n).click((function(){r()})),e("body").append(t),d.focus(),l.showpreview&&l.showpreview.call(i,o,f,d)}(g,this,s,r,l)})):s.find(".ff_fileupload_preview_image").prop("disabled",!0).attr("aria-label",t("No preview available")).click((function(e){e.preventDefault()})),w||s.find(".ff_fileupload_preview_image").addClass("ff_fileupload_preview_text_with_color").addClass("ff_fileupload_preview_text_"+v).text(_),l.accept){for(var C=!1,x=0;x<l.accept.length&&!C;x++)l.accept[x]!==_&&l.accept[x]!==r.files[0].type||(C=!0);C||r.ff_info.errors.push(t("Invalid file extension."))}l.maxfilesize>-1&&r.files[0].size>l.maxfilesize&&r.ff_info.errors.push(a(t("File is too large.  Maximum file size is {0}."),i(l.maxfilesize,l.adjustprecision,l.displayunits))),l.edit&&!r.ff_info.errors.length?s.find(".ff_fileupload_filename").append(e("<input>").attr("type","text").val(p).keydown((function(e){13==e.keyCode&&m(e)}))):s.find(".ff_fileupload_filename").text(r.files[0].name),s.find(".ff_fileupload_fileinfo").text(r.ff_info.displayfilesize+(w&&l.edit&&!r.ff_info.errors.length?" | ."+_:"")),r.ff_info.errors.length&&s.find(".ff_fileupload_errors").html(r.ff_info.errors.join("<br>")).removeClass("ff_fileupload_hidden"),r.ff_info.errors.length||(s.find(".ff_fileupload_actions").append(e("<button>").addClass("ff_fileupload_start_upload").attr("type","button").attr("aria-label",t("Start uploading")).click(m)),s.find(".ff_fileupload_actions_mobile").append(e("<button>").addClass("ff_fileupload_start_upload").attr("type","button").attr("aria-label",t("Start uploading")).click(m)),s.addClass("ff_fileupload_queued")),s.find(".ff_fileupload_actions").append(e("<button>").addClass("ff_fileupload_remove_file").attr("type","button").attr("aria-label",t("Remove from list")).click(h)),s.find(".ff_fileupload_actions_mobile").append(e("<button>").addClass("ff_fileupload_remove_file").attr("type","button").attr("aria-label",t("Remove from list")).click(h)),function(f){f.find("button").hover((function(){var a=e(this).attr("aria-label");a&&(f.find(".ff_fileupload_buttoninfo").text(a).removeClass("ff_fileupload_hidden"),f.find(".ff_fileupload_fileinfo").addClass("ff_fileupload_hidden"))}),(function(){f.find(".ff_fileupload_fileinfo").removeClass("ff_fileupload_hidden"),f.find(".ff_fileupload_buttoninfo").addClass("ff_fileupload_hidden")}))}(s),r.ff_info.fileinfo=s.find(".ff_fileupload_fileinfo"),r.ff_info.progressbar=s.find(".ff_fileupload_progress_bar"),f.append(s),l.added&&l.added.call(s,o,r)},s=function(e,f){var o=f.total<1?0:f.loaded/f.total*100;f.ff_info.fileinfo.text(a(t("{0} of {1} | {2}%"),i(f.loaded,l.adjustprecision,l.displayunits),f.ff_info.displayfilesize,o.toFixed(0))),f.ff_info.progressbar.css("width",o+"%"),l.continueupload&&!1===l.continueupload.call(f.ff_info.inforow,e,f)&&f.abort()},u=function(e,i){if(i.ff_info.lastresult&&!i.ff_info.lastresult.success&&(i.result=i.ff_info.lastresult,i.errorThrown="failed_with_msg"),"abort"!==i.errorThrown&&"failed_with_msg"!==i.errorThrown&&i.uploadedBytes<i.files[0].size&&i.ff_info.retries<l.retries)return i.ff_info.fileinfo.text(a(t("{0} | Network error, retrying in a moment... ({1})"),i.ff_info.displayfilesize,i.errorThrown)),i.ff_info.inforow.removeClass("ff_fileupload_uploading"),i.ff_info.inforow.addClass("ff_fileupload_starting"),setTimeout((function(){i.ff_info.inforow.removeClass("ff_fileupload_starting"),i.ff_info.inforow.addClass("ff_fileupload_uploading"),i.data=null,i.submit()}),i.ff_info.retrydelay),i.ff_info.retries++,void(i.ff_info.retrydelay*=2);i.ff_info.inforow.removeClass("ff_fileupload_uploading"),l.uploadcancelled&&l.uploadcancelled.call(i.ff_info.inforow,e,i),i.ff_info.removewidget?(i.ff_info.inforow.remove(),delete i.ff_info):("abort"===i.errorThrown?i.ff_info.errors.push(t("The upload was cancelled.")):"failed_with_msg"===i.errorThrown?i.ff_info.errors.push(a(t("The upload failed.  {0} ({1})"),f(i.result.error),f(i.result.errorcode))):i.ff_info.errors.push(t("The upload failed.")),i.ff_info.inforow.find(".ff_fileupload_errors").html(i.ff_info.errors.join("<br>")).removeClass("ff_fileupload_hidden"),i.ff_info.inforow.find(".ff_fileupload_progress_background").addClass("ff_fileupload_hidden"),i.ff_info.inforow.find("button.ff_fileupload_remove_file").attr("aria-label",t("Remove from list")))},p=function(e,f){if(!f.result.success)return"string"!=typeof f.result.error&&(f.result.error=t("The server indicated that the upload was not successful.  No additional information available.")),"string"!=typeof f.result.errorcode&&(f.result.errorcode="server_response"),f.errorThrown="failed_with_msg",f.ff_info.removewidget=!1,void u(e,f);f.ff_info.inforow.removeClass("ff_fileupload_uploading"),l.uploadcompleted&&l.uploadcompleted.call(f.ff_info.inforow,e,f),f.ff_info.removewidget?(f.ff_info.inforow.remove(),delete f.ff_info):(f.ff_info.inforow.find(".ff_fileupload_fileinfo").text(f.ff_info.displayfilesize+" | "+t("Upload completed")),f.ff_info.inforow.find(".ff_fileupload_progress_background").addClass("ff_fileupload_hidden"),f.ff_info.inforow.find("button.ff_fileupload_remove_file").attr("aria-label",t("Remove from list")))},_=function(e,f){if(f.ff_info&&(l.continueupload&&!1===l.continueupload.call(f.ff_info.inforow,e,f)&&(f.ff_info.lastresult&&!f.ff_info.lastresult.success||(f.ff_info.lastresult={success:!1})),f.ff_info.lastresult&&!f.ff_info.lastresult.success))return f.result=f.ff_info.lastresult,"string"!=typeof f.ff_info.lastresult.error&&(f.ff_info.lastresult.error=t("The server indicated that the upload was not successful.  No additional information available.")),"string"!=typeof f.ff_info.lastresult.errorcode&&(f.ff_info.lastresult.errorcode="server_response"),f.ff_info.removewidget=!1,!1},c=function(e,f){f.ff_info.retries=0,f.ff_info.retrydelay=l.retrydelay,f.ff_info.lastresult=f.result};return this.each((function(){var f=e(this);if(""===l.url){var i=f.closest("form").attr("action");i&&(l.url=i)}var o=e("<form>").addClass("ff_fileupload_hidden").attr({action:l.url,method:"post",enctype:"multipart/form-data"});for(var d in e("body").append(o),l.params)if(l.params.hasOwnProperty(d)){var n=e("<input>").attr({type:"hidden",name:d,value:l.params[d]});o.append(n)}var v=f.attr("name"),m=e("<input>").attr({type:"file",name:v||"file"});if(f.prop("multiple")&&m.prop("multiple",!0),f.attr("accept")&&(m.attr("accept",f.attr("accept")),!l.accept)){var h=f.attr("accept").split(",");l.accept=[];for(d=0;d<h.length;d++){var g=e.trim(h[d]).toLowerCase();l.accept.push(g.indexOf("/")<0&&g.lastIndexOf(".")>-1?g.substring(g.lastIndexOf(".")+1):g)}}o.append(m);var y=e("<div>").addClass("ff_fileupload_wrap");f.after(y);var w=e("<div>").addClass("ff_fileupload_dropzone_wrap"),b=e("<button>").addClass("ff_fileupload_dropzone").attr("type","button").attr("aria-label",t("Browse, drag-and-drop, or paste files to upload"));w.append(b),y.append(w),b.on("click.fancy_fileupload",(function(e){e.preventDefault(),o.find("input[type=file]").click()}));var C=e("<div>").addClass("ff_fileupload_dropzone_tools");if(w.append(C),l.recordaudio&&navigator.mediaDevices&&window.MediaRecorder){var x=e("<button>").addClass("ff_fileupload_dropzone_tool").addClass("ff_fileupload_recordaudio").attr("type","button").attr("aria-label",t("Record audio using a microphone"));C.append(x);var B=null,M=[];x.click((function(e){e.preventDefault(),B?B.stop():navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){(B=new MediaRecorder(e,l.audiosettings)).addEventListener("dataavailable",(function(f){if(f.data.size>0&&M.push(f.data),"inactive"===B.state){var i=new Blob(M,{type:"audio/mp3"});i.lastModifiedDate=new Date,i.lastModified=Math.floor(i.lastModifiedDate.getTime()/1e3),i.name=a(t("Audio recording - {0}.mp3"),i.lastModifiedDate.toLocaleString()),m.fileupload("add",{files:[i]}),e.getTracks().forEach((function(e){e.stop()})),x.removeClass("ff_fileupload_recording"),M=[],B=null}})),B.start(),x.addClass("ff_fileupload_recording")})).catch((function(e){alert(t("Unable to record audio.  Either a microphone was not found or access was denied."))}))}))}if(l.recordvideo&&navigator.mediaDevices&&window.MediaRecorder){var T=e("<button>").addClass("ff_fileupload_dropzone_tool").addClass("ff_fileupload_recordvideo").attr("type","button").attr("aria-label",t("Record video using a camera"));C.append(T);var k=e("<video>").prop("muted",!0).prop("autoplay",!0).addClass("ff_fileupload_recordvideo_preview").addClass("ff_fileupload_hidden");w.append(k);var z=null,D=[];T.click((function(e){if(e.preventDefault(),z)z.stop();else{var f=function(e){(z=new MediaRecorder(e,l.videosettings)).addEventListener("dataavailable",(function(f){if(f.data.size>0&&D.push(f.data),"inactive"===z.state){var i=new Blob(D,{type:"video/mp4"});i.lastModifiedDate=new Date,i.lastModified=Math.floor(i.lastModifiedDate.getTime()/1e3),i.name=a(t("Video recording - {0}.mp4"),i.lastModifiedDate.toLocaleString()),m.fileupload("add",{files:[i]}),e.getTracks().forEach((function(e){e.stop()})),T.removeClass("ff_fileupload_recording"),k.addClass("ff_fileupload_hidden"),""!==k[0].src&&(k[0].src=""),k[0].srcObject=null,D=[],z=null}})),z.start(),T.addClass("ff_fileupload_recording");try{k[0].src=URL.createObjectURL(e)}catch(f){k[0].srcObject=e}k.removeClass("ff_fileupload_hidden")};navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(f).catch((function(e){navigator.mediaDevices.getUserMedia({video:!0}).then(f).catch((function(e){alert(t("Unable to record video.  Either a camera was not found or access was denied."))}))}))}}))}var R=e("<table>").addClass("ff_fileupload_uploads");y.append(R),f.addClass("ff_fileupload_hidden");var U={url:l.url,dataType:"json",pasteZone:w,limitConcurrentUploads:2},L={singleFileUploads:!0,dropZone:b,add:function(e,f){r(R,e,f)},progress:s,fail:u,done:p,chunksend:_,chunkdone:c};m.fileupload(e.extend(U,l.fileupload,L)),f.data("fancy-fileupload",{fileuploadwrap:y,form:o,settings:l}),l.postinit&&l.postinit.call(f)}))},e.fn.FancyFileUpload.defaults={url:"",params:{},edit:!0,maxfilesize:-1,accept:null,displayunits:"iec_windows",adjustprecision:!0,retries:5,retrydelay:500,recordaudio:!1,audiosettings:{},recordvideo:!1,videosettings:{},preinit:null,postinit:null,added:null,showpreview:null,hidepreview:null,startupload:null,continueupload:null,uploadcancelled:null,uploadcompleted:null,fileupload:{},langmap:{}}}(jQuery);